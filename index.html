<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Doğum Günü Kartı</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; background: #fff8f0; }
    #girisEkrani { display: block; }
    #kartAlani { display: none; margin-top: 20px; }
    .kart { border: 2px dashed #ccc; padding: 20px; background: white; display: inline-block; }
    #preview img { max-width: 300px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }

    #mumAnimasyonu {
      font-size: 40px;
      animation: sönme 2s forwards;
      opacity: 1;
      margin-top: 10px;
    }

    @keyframes sönme {
      to { opacity: 0; }
    }

    #dilekMesaji {
      display: none;
      font-size: 20px;
      color: #d14;
      margin-top: 15px;
      animation: fadein 2s forwards;
    }

    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="girisEkrani">
    <h1>🎂 Mumları üflemeye hazır mısın? 🎉</h1>
    <button onclick="baslat()">Evet! Başlayalım</button>
  </div>

  <div id="kartAlani">
    <div id="mumAnimasyonu">🕯️🕯️🕯️</div>
    <div class="kart" id="preview">
      <h2 id="previewTitle">Mutlu Yıllar!</h2>
      <img id="previewImg" src="" alt="Fotoğraf">
      <p id="previewMsg">Harika bir doğum günü olsun!</p>
    </div>

    <div id="dilekMesaji">🌟 Dileğini tut! 🌟</div>

    <input type="file" accept="image/*" onchange="previewImage(event)">
    <input type="file" accept="audio/*" onchange="previewAudio(event)">
    <input type="text" id="titleInput" placeholder="Başlık" oninput="updateText()">
    <textarea id="messageInput" placeholder="Mesajını yaz..." rows="3" oninput="updateText()"></textarea>

    <audio id="audio" controls style="margin-top:15px;"></audio>

    <div style="margin-top:20px;">
      <button onclick="downloadCard()">📥 Kartı İndir</button>
      <button onclick="shareCard()">📤 Paylaş</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    function baslat() {
      document.getElementById('girisEkrani').style.display = 'none';
      document.getElementById('kartAlani').style.display = 'block';
      document.getElementById('dilekMesaji').style.display = 'block';
      document.getElementById('audio').play();
    }

    function previewImage(e){
      const reader = new FileReader();
      reader.onload = function(){
        document.getElementById('previewImg').src = reader.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    }

    function previewAudio(e){
      const audio = document.getElementById('audio');
      audio.src = URL.createObjectURL(e.target.files[0]);
    }

    function updateText(){
      document.getElementById('previewTitle').textContent = document.getElementById('titleInput').value || "Mutlu Yıllar!";
      document.getElementById('previewMsg').textContent = document.getElementById('messageInput').value || "Harika bir doğum günü olsun!";
    }

    function downloadCard(){
      html2canvas(document.getElementById("preview")).then(canvas=>{
        canvas.toBlob(blob=>{
          saveAs(blob, "dogum_gunu_karti.png");
        });
      });
    }

    async function shareCard(){
      const canvas = await html2canvas(document.getElementById("preview"));
      const blob = await new Promise(res => canvas.toBlob(res, "image/png"));
      const file = new File([blob], "dogum_gunu_karti.png", {type: "image/png"});

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({
            files: [file],
            title: "Doğum Günü Kartım",
            text: "Senin için özel bir kart hazırladım 🎉"
          });
        } catch (err) {
          alert("Paylaşım iptal edildi.");
        }
      } else {
        alert("Tarayıcınız paylaşım desteklemiyor.");
      }
    }
  </script>
</body>
</html>
